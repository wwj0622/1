<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.topscit.springboot1.dao.BuyMapper" >
  <resultMap id="BaseResultMap" type="com.topscit.springboot1.bean.Buy" >
    <id column="bid" property="bid" jdbcType="VARCHAR" />
    <result column="bstate" property="bstate" jdbcType="VARCHAR" />
    <result column="btime" property="btime" jdbcType="TIMESTAMP" />
    <result column="baddress" property="baddress" jdbcType="VARCHAR" />
    <result column="bman" property="bman" jdbcType="VARCHAR" />
    <result column="bremark" property="bremark" jdbcType="VARCHAR" />
    <result column="sid" property="sid" jdbcType="VARCHAR" />
    <result column="gupdate_time" property="gupdateTime" jdbcType="TIMESTAMP" />
    <association property="supplier" column="sid" javaType="com.topscit.springboot1.bean.Supplier">
        <id column="sid" property="sid" jdbcType="VARCHAR" />
    	<result column="sname" property="sname" jdbcType="VARCHAR" />
	    <result column="sphone" property="sphone" jdbcType="VARCHAR" />
	    <result column="saddress" property="saddress" jdbcType="VARCHAR" />
	    <result column="semail" property="semail" jdbcType="VARCHAR" />
	    <result column="saccount" property="saccount" jdbcType="VARCHAR" />
	    <result column="sstate" property="sstate" jdbcType="VARCHAR" />
	    <result column="sremark" property="sremark" jdbcType="VARCHAR" />
	    <result column="supdate_time" property="supdateTime" jdbcType="TIMESTAMP" />
	    <result column="screate_time" property="screateTime" jdbcType="TIMESTAMP" />
	    <result column="slogo" property="slogo" jdbcType="VARCHAR" />
    </association>
  </resultMap>
  <sql id="Base_Column_List" >
    bid, bstate, btime, baddress, bman, bremark, sid, gupdate_time
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.String" >
    select 
    <include refid="Base_Column_List" />
    from buy
    where bid = #{bid,jdbcType=VARCHAR}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String" >
    delete from buy
    where bid = #{bid,jdbcType=VARCHAR}
  </delete>
  <insert id="insert" parameterType="com.topscit.springboot1.bean.Buy" >
    insert into buy (bid, bstate, btime, 
      baddress, bman, bremark, 
      sid, gupdate_time)
    values (#{bid,jdbcType=VARCHAR}, #{bstate,jdbcType=VARCHAR}, #{btime,jdbcType=TIMESTAMP}, 
      #{baddress,jdbcType=VARCHAR}, #{bman,jdbcType=VARCHAR}, #{bremark,jdbcType=VARCHAR}, 
      #{sid,jdbcType=VARCHAR}, #{gupdateTime,jdbcType=TIMESTAMP})
  </insert>
  <insert id="insertSelective" parameterType="com.topscit.springboot1.bean.Buy" >
    insert into buy
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="bid != null" >
        bid,
      </if>
      <if test="bstate != null" >
        bstate,
      </if>
      <if test="btime != null" >
        btime,
      </if>
      <if test="baddress != null" >
        baddress,
      </if>
      <if test="bman != null" >
        bman,
      </if>
      <if test="bremark != null" >
        bremark,
      </if>
      <if test="sid != null" >
        sid,
      </if>
      <if test="gupdateTime != null" >
        gupdate_time,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="bid != null" >
        #{bid,jdbcType=VARCHAR},
      </if>
      <if test="bstate != null" >
        #{bstate,jdbcType=VARCHAR},
      </if>
      <if test="btime != null" >
        #{btime,jdbcType=TIMESTAMP},
      </if>
      <if test="baddress != null" >
        #{baddress,jdbcType=VARCHAR},
      </if>
      <if test="bman != null" >
        #{bman,jdbcType=VARCHAR},
      </if>
      <if test="bremark != null" >
        #{bremark,jdbcType=VARCHAR},
      </if>
      <if test="sid != null" >
        #{sid,jdbcType=VARCHAR},
      </if>
      <if test="gupdateTime != null" >
        #{gupdateTime,jdbcType=TIMESTAMP},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.topscit.springboot1.bean.Buy" >
    update buy
    <set >
      <if test="bstate != null" >
        bstate = #{bstate,jdbcType=VARCHAR},
      </if>
      <if test="btime != null" >
        btime = #{btime,jdbcType=TIMESTAMP},
      </if>
      <if test="baddress != null" >
        baddress = #{baddress,jdbcType=VARCHAR},
      </if>
      <if test="bman != null" >
        bman = #{bman,jdbcType=VARCHAR},
      </if>
      <if test="bremark != null" >
        bremark = #{bremark,jdbcType=VARCHAR},
      </if>
      <if test="sid != null" >
        sid = #{sid,jdbcType=VARCHAR},
      </if>
      <if test="gupdateTime != null" >
        gupdate_time = #{gupdateTime,jdbcType=TIMESTAMP},
      </if>
    </set>
    where bid = #{bid,jdbcType=VARCHAR}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.topscit.springboot1.bean.Buy" >
    update buy
    set bstate = #{bstate,jdbcType=VARCHAR},
      btime = #{btime,jdbcType=TIMESTAMP},
      baddress = #{baddress,jdbcType=VARCHAR},
      bman = #{bman,jdbcType=VARCHAR},
      bremark = #{bremark,jdbcType=VARCHAR},
      sid = #{sid,jdbcType=VARCHAR},
      gupdate_time = #{gupdateTime,jdbcType=TIMESTAMP}
    where bid = #{bid,jdbcType=VARCHAR}
  </update>
  
  <select id="getAllBuy" resultMap="BaseResultMap" >
  	SELECT *,CASE buy.bstate
	WHEN "1" THEN
		"已入库"
	ELSE
		"未入库"
	END as state
	FROM buy inner join supplier where buy.sid=supplier.sid and buy.bstate="0"
   </select>
   	
   	 <select id="getAllBuyIn" resultMap="BaseResultMap" >
  	SELECT *,CASE buy.bstate
	WHEN "1" THEN
		"已入库"
	ELSE
		"未入库"
	END as state
	FROM buy where bstate="1"
   </select>
   	
	 <select id="getBuyByTime" resultMap="BaseResultMap" parameterType="java.util.HashMap" >
	     select * from buy
	    where btime <![CDATA[ >= ]]> CONCAT(#{beginDate},' 00:00:00')
	    and btime <![CDATA[ <= ]]> CONCAT(#{endDate},' 23:59:59')
	    
	</select>   
	
	<update id="updateStateByBid" parameterType="java.lang.String">
		UPDATE buy SET buy.bstate="1" WHERE bid = #{bid}
	</update>
	
	
</mapper>